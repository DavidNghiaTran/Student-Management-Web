{% extends "_layout.html" %}

{% block title %}Trang chủ Sinh viên{% endblock %}

{% block styles %}
<style>
    .dashboard-grid {
        display: grid;
        /* Tạo 2 cột, cột đầu tiên chiếm ít không gian hơn cho ảnh */
        grid-template-columns: auto 1fr;
        gap: 20px;
        align-items: start; /* Căn các card theo đầu */
    }

    /* Thẻ thông tin SV */
    .student-info-card {
        display: flex;
        align-items: center; /* Căn giữa ảnh và text */
        gap: 20px;
        padding-bottom: 0; /* Xóa padding dưới nếu không cần */
    }
    .student-avatar img {
        width: 100px;
        height: 100px;
        border-radius: 50%; /* Ảnh tròn */
        border: 3px solid #eee;
        object-fit: cover; /* Đảm bảo ảnh không bị méo */
    }
    .student-details ul {
        list-style: none;
        padding-left: 0;
        line-height: 1.8;
        font-size: 0.95rem;
    }
    .student-details ul strong {
        display: inline-block;
        min-width: 90px;
        color: #555;
    }

    /* Thẻ thông báo */
    .notification-list {
        max-height: 300px; /* Giới hạn chiều cao, thêm thanh cuộn nếu cần */
        overflow-y: auto;
    }
    .notification-item {
        border-bottom: 1px dashed #eee;
        padding: 12px 0;
    }
    .notification-item:last-child {
        border-bottom: none;
        padding-bottom: 0;
     }
     .notification-item:first-child {
        padding-top: 0;
     }
    .notification-item a {
        text-decoration: none;
        color: var(--primary-color); /* Sử dụng màu đỏ từ layout */
        font-weight: 500;
        font-size: 1rem;
        display: block; /* Cho link chiếm cả dòng */
        margin-bottom: 4px;
    }
     .notification-item a:hover {
        text-decoration: underline;
     }
    .notification-item small {
        color: #777;
        font-size: 0.85rem;
     }
     .notification-item p.content { /* Thêm style cho nội dung nếu cần */
        margin-top: 5px;
        font-size: 0.9rem;
        color: #444;
     }


    /* Responsive cho Grid */
    @media (max-width: 992px) { /* Chuyển thành 1 cột sớm hơn */
        .dashboard-grid {
            grid-template-columns: 1fr; /* 1 cột */
        }
    }
     @media (max-width: 576px) { /* Style cho mobile */
        .student-info-card {
            flex-direction: column; /* Xếp ảnh trên text */
            align-items: flex-start;
        }
    }
</style>
{% endblock %}


{% block content %}

    <div class="dashboard-grid">
        <div class="card">
            <div class="card-header">Thông tin sinh viên</div>
            <div class="card-body student-info-card">
                <div class="student-avatar">
                    <img src="{{ url_for('static', filename='avatar_default.png') }}" alt="Ảnh đại diện">
                </div>
                <div class="student-details">
                    <ul>
                        <li><strong>Mã SV:</strong> {{ sinh_vien.ma_sv if sinh_vien else 'N/A' }}</li>
                        <li><strong>Họ tên:</strong> {{ sinh_vien.ho_ten if sinh_vien else 'N/A' }}</li>
                        <li><strong>Ngày sinh:</strong> {{ sinh_vien.ngay_sinh.strftime('%d-%m-%Y') if sinh_vien and sinh_vien.ngay_sinh else 'N/A' }}</li>
                        <li><strong>Email:</strong> {{ sinh_vien.email if sinh_vien and sinh_vien.email else 'N/A' }}</li>
                        <li><strong>Trạng thái:</strong> Đang học</li> </ul>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">Thông tin khóa học</div>
            <div class="card-body"> <ul style="list-style: none; padding-left: 0; line-height: 1.8; font-size: 0.95rem;">
                     <li><strong>Lớp:</strong> {{ sinh_vien.lop if sinh_vien and sinh_vien.lop else 'N/A' }}</li>
                     <li><strong>Khoa:</strong> {{ sinh_vien.khoa if sinh_vien and sinh_vien.khoa else 'N/A' }}</li>
                     <li><strong>Khóa học:</strong> 2022-2027 (Ví dụ)</li> <hr style="border: none; border-top: 1px dashed #eee; margin: 10px 0;">
                     <li><strong>Cố vấn HT:</strong> Nguyễn Thị Thủy Nga (Ví dụ)</li> <li><strong>Email CV:</strong> ngantt2@ptit.edu.vn (Ví dụ)</li> </ul>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">Thông báo mới nhất (Lớp: {{ sinh_vien.lop if sinh_vien and sinh_vien.lop else 'N/A' }})</div>
        <div class="card-body notification-list">
            {% if notifications %}
                {% for msg in notifications %}
                <div class="notification-item">
                    <a href="#">{{ msg.tieu_de }}</a>
                    <small>
                        Từ: <strong>{{ msg.ma_gv }}</strong> |
                        Ngày: {{ msg.ngay_gui.strftime('%d-%m-%Y %H:%M') }}
                    </small>
                    </div>
                {% endfor %}
            {% else %}
                <p>Hiện không có thông báo nào cho lớp của bạn.</p>
            {% endif %}
        </div>
    </div>

    <div class="card">
        <div class="card-header">Kết quả học tập (Tổng quan)</div>
        <div class="card-body">
            <p>Biểu đồ hiển thị điểm (hệ 10) của tất cả các môn đã có điểm.</p>
            {% if chart_labels %}
                <div style="max-width: 900px; margin: 20px auto 0 auto; height: 350px;"> <canvas id="gradesChart"></canvas>
                </div>
            {% else %}
                <p>Chưa có dữ liệu điểm để vẽ biểu đồ.</p>
            {% endif %}
        </div>
    </div>

    {% if chart_labels %}
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Lấy dữ liệu từ app.py
        const labels = {{ chart_labels | tojson | safe }};
        const data = {{ chart_data | tojson | safe }};

        const ctx = document.getElementById('gradesChart').getContext('2d');
        if (ctx) { // Kiểm tra xem canvas có tồn tại không
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Điểm hệ 10',
                        data: data,
                        backgroundColor: 'rgba(183, 28, 28, 0.7)', // Màu đỏ
                        borderColor: 'rgba(183, 28, 28, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false, // Cho phép biểu đồ co giãn chiều cao
                    scales: {
                         x: {
                            title: {
                                display: true,
                                text: 'Mã Môn học'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            max: 10,
                             title: {
                                display: true,
                                text: 'Điểm (Hệ 10)'
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }
    });
    </script>
    {% endif %}

{% endblock %}